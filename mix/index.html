<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="Endlessly mix everything!">
    <meta name="keywords" content="R74n, ryan, RyanUwU, slweeb, 4755, elements, elemental, alchemy, little alchemy">
    <meta name="author" content="R74n">
    <meta name="viewport" content="width=devide-width, initial-scale=1.0">
    <meta name="twitter:image:alt" content="R74n">
    <title>Mix Everything!</title>
    <link rel="stylesheet" type="text/css" href="../stylesheet.css"/>
    <link rel="stylesheet" type="text/css" href="../normalize.css"/>
    <link rel="icon" href="../favicon.ico" type="image/gif" sizes="16x16">
    <script src="../cookiescripts.js"></script>
    <script src="../scripts.js"></script>
    <style>
      .deletebutton {margin-left:5px;cursor:pointer;}
    </style>
    <script>

      function savelist() {
        localStorage.setItem("itemlist",itemlist.join(" ||| "));
        localStorage.setItem("combolist",combolist.join(" ||| "));
      }
      function saveoptions() {
        localStorage.setItem("options",JSON.stringify(options));
        var starters = document.getElementById("StarterBox").value.replaceAll(", ",",").replaceAll(" ,",",").split(",");
        localStorage.setItem("starters",starters.join(", "));
      }
      function resetsave() {
        localStorage.removeItem("itemlist");
        localStorage.removeItem("combolist");
        var starters = document.getElementById("StarterBox").value.replaceAll(", ",",").replaceAll(" ,",",").split(",");
        localStorage.setItem("starters",starters.join(", "));
        location.reload();
      }
      function updatestarterbox() {
        document.getElementById("StarterBox").value = localStorage.getItem("starters")
      }
      function loadsave() {
        var starters = localStorage.getItem("starters");
        if (starters==null) {
          starters = "air,earth,fire,water,void,life"
          localStorage.setItem("starters",starters);
        }
        itemlist = localStorage.getItem("itemlist")
        var newgame = false;
        if (itemlist==null) {
          itemlist = starters.split(",");
          var newgame = true;
        }
        else {itemlist = itemlist.split(" ||| ")}
        combolist = localStorage.getItem("combolist")
        if (combolist==null) {
          combolist = [];
          var newgame = true;
        }
        else {combolist = combolist.split(" ||| ")}
        combokeys = [];
        for (var n in combolist) {
          var comboline = combolist[n];
          combokeys.push(comboline.split(": ")[0])
        }
        if (combolist.includes("")) {
          combolist.splice(combolist.indexOf(""), 1);
          combokeys.splice(combokeys.indexOf(""), 1);
        }
        options = JSON.parse(localStorage.getItem("options"));
        if (options==null) {
          options = {};
          var newgame = true;
        }
        defaultoptions = {"more_operators":false,"ideas":false};
        for (var key in defaultoptions) {
          if (!(key in options)) {
            value = defaultoptions[key];
            options[key] = value
            var newgame = true;
          }
        }

        if (newgame) {savelist();saveoptions();}
      }

      function chooseweighted(items, chances) {
        var sum = chances.reduce((acc, el) => acc + el, 0);
        var acc = 0;
        chances = chances.map(el => (acc = el + acc));
        var rand = Math.random() * sum;
        return items[chances.filter(el => el <= rand).length];
      }
      function weightedchances(items) {
        var chances = [];
        for (var n in items) {
          chances.push(items.length-n)
        }
        return chances;
      }
      function choosecombo(){
        document.getElementById("ResultInput").value = "";
        var chances = weightedchances(itemlist);
        var item1 = chooseweighted(itemlist,chances);//randomChoice(itemlist);
        var item2 = chooseweighted(itemlist,chances);//randomChoice(itemlist);
        if (!options["more_operators"]) {
          var combo = item1+" + "+item2;
          var combo2 = item2+" + "+item1;
        }
        else {
          var combo0 = bettercombo(item1,item2);
          var combo = combo0[0];
          if (combo0.length > 1) {var combo2 = combo0[1];}
          else {var combo2 = combo}
        }
        if (combokeys.includes(combo)||combokeys.includes(combo2)) {
          //console.log("AAAAA");
          choosecombo();
        }
        else {
          setText("Combination",combo+" = ?");
          document.getElementById("Combination").setAttribute("combo",combo);
        }
      }

      function simplify(text) {
        if (!text.match(/^'+$/g)) {text=text.replace("'","")}
        if (!text.match(/^\-+$/g)) {text=text.replace("-","")}
        return text.toLowerCase().replace(" ","");
      }
      function singular(text) {
        if (text.length < 3) {return text}
        else if (text.endsWith("ies")) {return text.slice(0,-3)+"y"}
        else if (text.endsWith("ses")||text.endsWith("hes")) {return text.slice(0,-2)}
        else if (text.endsWith("s")) {return text.slice(0,-1)}
      }
      function plural(text) {
        if (text.length < 3) {return text}
        else if (text.endsWith("y") && (!text.endsWith("ey"))) {return text.slice(0,-1)+"ies"}
        else if (text.endsWith("s")||text.endsWith("ch")||text.endsWith("sh")||text.endsWith("th")) {return text+"es"}
        else {return text+"s"}
      }
      function finditem(item) {
        var simpleitem = simplify(item);
        var itemsing = singular(simpleitem);
        var itempl = plural(simpleitem);
        for (var n in itemlist) {
          var i = itemlist[n];
          var simplei = simplify(i);
          if ((simplei==simpleitem)||(simplei==itemsing)||(simplei==itempl)) {return i;}
        }
        return item;
      }
      function submitcombo() {
        var combo = document.getElementById("Combination").getAttribute("combo");
        var ResultBox = document.getElementById("ResultInput");
        var newitem = finditem(ResultBox.value.toLowerCase());
        //console.log(newitem);
        if (newitem.includes(" + ")) {alert("Items cannot contain \" + \"");}
        else if (newitem.includes(": ")) {alert("Items cannot contain \": \"");}
        else if (newitem.replaceAll(" ","").length == 0) {return}
        else {
          combolist.push(combo+": "+newitem);
          combokeys.push(combo);
          if (!itemlist.includes(newitem)) {
            itemlist.push(newitem);
          }
          choosecombo();
          savelist();
          updatetext();
        }
      }
      function deletecombo(combo) {
        combolist.splice(combolist.indexOf(combo), 1);
        combokeys.splice(combokeys.indexOf(combo.split(": ")[0]), 1);
        updatetext();
      }
      function updatetext() {
        setText("ItemList",itemlist.join("<br>"));
        combotext = "";
        for (var n in combolist) {
          combo = combolist[n];
          combotext = combotext+combo+"<br>"//+"<a class='deletebutton' onclick='deletecombo(&quot;"+combo+"&quot;)'>x</a><br>"
        }
        setText("ComboList",combotext);
      }
      function toggle(option) {
        options[option] = !options[option];
        saveoptions();
      }
      function updatechecks() {
        document.getElementById("OperatorCheckbox").checked = options["more_operators"];
      }
      combotemplates = ["ITEM1 + ITEM2","ITEM1 + ITEM2","ITEM1 + ITEM2","ITEM1 + ITEM2","ITEM1 + ITEM2","ITEM1 + ITEM2","ITEM1 - ITEM2","ITEM1 × 2","ITEM1 ÷ 2","sqrt(ITEM1)","ITEM1²"];
      function bettercombo(item1,item2) {
        var combotemp = randomChoice(combotemplates);
        var combo = combotemp.replaceAll("ITEM1",item1).replaceAll("ITEM2",item2);
        if (combotemp.includes("ITEM2")) {
          var combo2 = combotemp.replaceAll("ITEM1",item2).replaceAll("ITEM2",item1)
        }
        else {var combo2 = combo}
        return [combo,combo2]
      }




      loadsave();
    </script>

</head>

<body>


<a href="https://R74n.com" class="backbutton">⦉</a>
<h1 class="pagetitle">Mix-Up!</h1><br>
<div class="content" style="text-align:center;">

<form id="InputForm" onsubmit="submitcombo();return false;" autocomplete="off">
<span id="Combination" style="font-size:25px;display:block;padding-bottom:20px;">Loading...</span>
<input id="ResultInput" type="text" autofocus style="text-align:center;" placeholder="Type the result" title="Type the result of the above combination">

</form>
<span id="ItemList" style="display:block;padding:20px;"></span>
<span id="ComboList" style="display:block;padding-bottom:20px;"></span>


<input class="checkbox" id="OperatorCheckbox" type="checkbox" value="" onclick="toggle('more_operators');">
<label for="OperatorCheckbox">More Operators</label>

<br><br>

<input type="button" value="Reset Save Data" id="ResetButton" onclick="resetsave();" style="display:inline-block;padding-bottom:20px;background-color:red">
<input type="text" id="StarterBox">





<script>updatetext();updatechecks();choosecombo();updatestarterbox();</script>

</div>




<!-- i like having this but ublock blocks these things anyway -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-93720349-6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-93720349-6');
</script>



</body>
</html>
